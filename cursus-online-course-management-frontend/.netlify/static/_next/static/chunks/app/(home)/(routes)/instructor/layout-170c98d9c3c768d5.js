(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9147],{55316:function(e,r,t){Promise.resolve().then(t.bind(t,32585))},32585:function(e,r,t){"use strict";t.r(r);var n=t(57437),o=t(32161),s=t(80115),a=t(16463),u=t(2265);r.default=e=>{let{children:r}=e;(0,s.j)();let t=(0,a.useRouter)();return(0,u.useEffect)(()=>{(0,o.w)()||t.push("/authenticate/login")},[t]),(0,n.jsx)(n.Fragment,{children:r})}},1398:function(e,r,t){"use strict";var n=t(38472),o=t(7561);let s=n.Z.create({baseURL:"https://guardianshield.uk/",withCredentials:!0});s.interceptors.request.use(async e=>{let r;return console.log("Client side cookies: ",r=o.Z.get("jwtToken")),r&&(e.headers.Authorization="Bearer ".concat(r)),e.data instanceof FormData||(e.headers["Content-Type"]="application/json"),e},e=>Promise.reject(e)),r.Z=s},32161:function(e,r,t){"use strict";t.d(r,{w:function(){return n}});let n=()=>{let e=localStorage.getItem("userData");return!!e&&JSON.parse(e).roles.includes("ROLE_INSTRUCTOR")}},80115:function(e,r,t){"use strict";t.d(r,{j:function(){return i}});var n=t(7561),o=t(10209),s=t(1398);let a=async e=>{try{return await s.Z.get("/api/auth/verifyToken?token="+e),console.log("[ACTIONS_IS_TOKEN_EXPIRED] Token is valid"),!1}catch(e){return console.log("[ACTIONS_IS_TOKEN_EXPIRED]",e),!0}},u=async e=>{let{accessToken:r,refreshToken:t}=e;try{console.log("[ACTIONS_GET_REFRESH_TOKEN] Requesting refresh token: accessToken",r,"refreshToken",t);let e=await s.Z.post("/api/auth/refreshToken",{accessToken:r,refreshToken:t});return console.log("[ACTIONS_GET_REFRESH_TOKEN] Refresh token response: ",e.data),e.data}catch(e){if(console.error("[ACTIONS_GET_REFRESH_TOKEN]",e),e.response&&e.response.data)throw Error(e.response.data.message||"Something went wrong!");throw Error(e.message||"Something went wrong!")}},c=()=>{localStorage.removeItem("userData"),n.Z.remove("jwtToken"),n.Z.remove("refreshToken"),o.ZP.error("Session expired. Please login again"),window.location.href="/authenticate/login"},i=async()=>{let e=n.Z.get("jwtToken"),r=n.Z.get("refreshToken");if(!e||!r)return c(),!1;if(await a(e)===!0)try{let t=await u({accessToken:e,refreshToken:r});console.log("Refresh token response: ",t),n.Z.set("jwtToken",t.token),n.Z.set("refreshToken",t.refreshToken)}catch(e){return l(e),c(),!1}return!0},l=e=>{if(e.response)switch(e.response.status){case 403:o.ZP.error("You do not have permission to access this resource.");break;case 401:o.ZP.error("Session expired. Please login again.");break;case 500:o.ZP.error("Server error. Please try again later.");break;default:o.ZP.error("An error occurred. Please try again.")}else o.ZP.error("Network error. Please check your connection.")}},16463:function(e,r,t){"use strict";var n=t(71169);t.o(n,"redirect")&&t.d(r,{redirect:function(){return n.redirect}}),t.o(n,"useParams")&&t.d(r,{useParams:function(){return n.useParams}}),t.o(n,"usePathname")&&t.d(r,{usePathname:function(){return n.usePathname}}),t.o(n,"useRouter")&&t.d(r,{useRouter:function(){return n.useRouter}}),t.o(n,"useSearchParams")&&t.d(r,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[5508,209,2971,7023,1744],function(){return e(e.s=55316)}),_N_E=e.O()}]);